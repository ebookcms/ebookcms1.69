/* ------------------------------------------------------------------------------

	eBookRTE - Version: 1.69 (September 16, 2015)
	Rich-Text Editor : http://www.eboockcms.com/
	Copyright (C) 2015 Rui Mendes. All Rights Reserved. 
	eBookRTE is licensed under a "Creative Commons License"

--------------------------------------------------------------------------------- */

function FindObject(t){for(var e=(Objects.length,0);nObjs>e;e++)if(Objects[e].name==t)return Objects[e]}function ebookRTE(t){if(this.numName=nObjs,Objects[nObjs]=this,nObjs++,document.getElementById)var e=document.getElementById(t);else alert("Your browser lacks the capabilities required to run this script!"),exit();this.name=t,this.rows=e.rows,this.cols=e.cols,this.txteditor="ebook"+t,this.htmeditor="ebhtm"+t,this.html=e.value,this.html=this.html.replace(/(\&CR\;)/gi,"\n"),this.cssfile="css/content.css",this.isEditable=!0,this.wwidth=650,this.wheight=300,this.iconHeight=16,this.iconWidth=16,this.toolbar1="split,switchmode,split,bold,italic,underline,strikethrough,split,justifyleft,justifycenter,justifyright,split,subscript,superscript,split,insertorderedlist,insertunorderedlist,split,insertparagraph,linebreak,line,split,table,image,link,unlink,clean_tags,split,h1,h2,h3,split,youtube,smcool,smcry,smembarrassed,smsmille",this.nToolbars=0,this.externalcmds="switchmode,table,image,newLink,youtube,clean_tags",this.outcmds="span,pre",this.DOMcommands="bold,italic,underline,strikethrough,justifyleft,justifycenter,justifyright,insertorderedlist,insertunorderedlist,insertHTML,subscript,superscript,link,unlink,inserthorizontalrule",this.insHTML="insertparagraph,h1,h2,h3,address,blockquote,div,linebreak,span,code,pre",this.BBcode="",this.ytWidth=640,this.ytHeight=480,this.ytfborder=0,this.divcontent="main_content",this.ytoptions="allowfullscreen",this.smilley="smcool,smcry,smembarrassed,smsmille",this.smilleyext=".png",this.smilleytxt="",this.addcmde="",this.addcmdi="",this.version="1.65",e.setAttribute("style","display: none; margin: 0px; padding: 0px; border: none; font-size:0;"),this.prepareEditor()}function startEditor(t){return t=new ebookRTE(t)}function FindMsg(t){for(var e="",i="",s="",r=0;r<msg.length;r++)if(e=msg[r].split("|"),e[0]==t)return i=e[1],s=e[2],{title:i,alt:s};return null}function editorCommand(t,e,i){var s=Objects[t];s.editorCommand(e,i)}function uSubmit(t){var e=FindObject(t);if(e.isEditable){var i=document.getElementById(e.htmeditor),s=i.contentWindow.document.body.innerHTML;s=s.replace(/(\<)(iframe)((\x20(width|height|frameborder)="\d+"|allowfullscreen){0,})(\x20src="(http\:\/\/www\.youtube\.com\/embed\/\w+)")([^><]*)(\>\<\/iframe\>)/gi,"[video=youtube]$7[/video]"),s=s.replace(/(<)([A-Z1-9]+)(>)/gi,function(t){return t.toLowerCase()}),s=s.replace(/(<\/)([A-Z1-9]+)(>)/gi,function(t){return t.toLowerCase()}),s=s.replace(/<(A|DIV|P)/gi,function(t){return t.toLowerCase()}),s=s.replace(/<(p|div|span)\s(style="text-align: center;")([^>]*)(>)/gi,'<$1 class="center"$3>');var r=document.getElementById(e.txteditor);r.value=s}}var Objects=[],nObjs=0,msg=["switchmode|Change Mode (CODE/HTML)|smo","bold|Bold|bol","italic|Italic|ita","underline|Underline|und","strikethrough|Strike|stk","h1|Heading 1|h1","h2|Heading 2|h2","h3|Heading 3|h3","justifyleft|Align left|alf","justifycenter|Align center|ace","justifyright|Align right|ari","subscript|Subscript|sub","superscript|Superscript|sup","insertparagraph|Insert Paragraph|par","linebreak|Line Break|lbr","insertorderedlist|Ordered List|oli","insertunorderedlist|Unordered list|uli","table|Insert table|tbl","image|insert image|img","link|Insert link|lnk","unlink|Remove Link|ulk","address|Address|adr","div|Division or section|div","span|Group inline|spn","blockquote|Blockquote|blq","pre|Preformatted|pre","code|Code|cod","table|Insert table|tbl","image|insert image|img","link|Insert link|lnk","unlink|Remove Link|ulk","youtube|YouTube|ytb","clean_tags|Clean Tags|clt"],warnings=["eBookRTE constructor(editor, objName, html code, cssfile) failed, four arguments are required","Designmode is not support by your browser, please update.","List already exists","Command not supported by your browser","This command is not supported when you selected this object.","Please select some text to use this function","Table already exists","Move cursor to end </li> tag","Old Browser, is best you upgrade"],msgpr=["Enter a URL:","Enter a Title:","Enter a Image URL:","Enter a Alt:","Enter a border size:","How many rows","How many cells","Youtube Video"];ebookRTE.prototype={detectBrowser:function(){var t="",e=navigator.userAgent.toLowerCase();return-1!=e.indexOf("opera")?t="opera":-1!=e.indexOf("msie")?t="msie":-1!=e.indexOf("chrome")?t="chrome":-1!=e.indexOf("safari")?t="safari":-1!=e.indexOf("android")?t="android":-1!=e.indexOf("mozilla")&&(t=-1!=e.indexOf("firefox")?"firefox":"mozilla"),t},add_captions:function(t){alert(t),msg.push(t)},add_cmd:function(t,e){this.externalcmds+=""!==this.externalcmds?","+t:t,""!=langs&&msg.push(e)},prepareEditor:function(){if(""!==this.toolbar1&&null!==this.toolbar1&&void 0!==this.toolbar1&&this.nToolbars++,""!==this.toolbar2&&null!==this.toolbar2&&void 0!==this.toolbar2&&this.nToolbars++,""!==this.toolbar3&&null!==this.toolbar3&&void 0!==this.toolbar3&&this.nToolbars++,""!==this.toolbar4&&null!==this.toolbar4&&void 0!==this.toolbar4&&this.nToolbars++,""!=this.smilleytxt){var t=this.smilleytxt;t=t.split(",");for(var e=0;e<t.length;e++)msg.push(t[e])}if(""!=this.addcmde)for(var i=this.addcmde,s=i.split(","),e=0;e<s.length;e++)this.externalcmds+=""!==this.externalcmds?","+s[e]:s[e];if(""!=this.addcmdi)for(var r=this.addcmdi,n=r.split(","),e=0;e<n.length;e++){var o=n[e].split("|"),l=o[0];this.externalcmds+=""!==this.externalcmds?","+o[0]:o[0],this.add_newcmd(l,o[3],o[4],o[5],"");var a=l+"|"+o[1]+"|"+o[2];msg.push(a)}},showButtoms:function(t){var e="",i="",s="",r="",n="",o="";switch(-1!=t.indexOf("bbc")?(n=t.substring(3),r=FindMsg(n)):r=FindMsg(t),t){case"link":t="newLink",o="link.png",r&&(i=r.title,s=r.alt);break;case"line":t="inserthorizontalrule",o="line.png",r&&(i=r.title,s=r.alt);break;default:e=t,o=-1!=this.smilley.indexOf(t)?t+this.smilleyext:-1!=this.BBcode.indexOf(t)&&""!=n?n+".png":t+".png",r&&(i=r.title,s=r.alt,o=t+".png")}var l="<li><a href=\"javascript: editorCommand('"+this.numName+"', '"+t+"');\"";return l+=' id ="bt'+this.txteditor+t+'" title ="'+i+'">',l+='<img src="js/editor/'+o+'" width="'+this.iconWidth+'px" height="'+this.iconHeight+'px" alt="'+s+'"></a></li>'},designer:function(){if(this.isEditable===!0){var t="<html><head>";t+='<link rel="stylesheet" type="text/css" href="'+this.cssfile+'" />',t+="<style>* {margin:0; padding:0;} body{background: #FFF; padding: 15px;}</style>",t+="</head><body class="+this.divcontent+">",t+=this.loadhtml(this.html)+"</body></html>";try{var e=document.getElementById(this.htmeditor),i="";if(i=e.contentDocument&&e.contentDocument.document?e.contentDocument.document:e.contentWindow&&e.contentWindow.document?e.contentWindow.document:e.documentMode?e.documentMode:e.compatMode?e.documentMode:e.document,i&&""==i)return void alert("Old Browser, not supported");i.open(),i.write(t),i.close(),i.designMode="On",e.contentDocument&&e.contentDocument.designMode&&(e.contentDocument.designMode="on")}catch(s){alert("Some error in designer mode - "+s.name+": "+s.message)}}},drawToolbar:function(t){var e=t;if(bt="",""!==t&&null!==t){e=e.split(",");for(var i='<li><img src="js/editor/split.png"></li>',s="<li>&nbsp;</li>",r=0;r<e.length;r++)switch(e[r]){case"space":bt+=s;break;case"split":bt+=i;break;default:e[r]&&(bt+=this.showButtoms(e[r]))}}return bt},WscrollBarWidth:function(){document.body.style.overflow="hidden";var t=document.body.clientWidth;return document.body.style.overflow="scroll",t-=document.body.clientWidth,t||(t=document.body.offsetWidth-document.body.clientWidth),document.body.style.overflow="",t},displayEditor:function(){this.prepareEditor();var t,e=this.showButtons(this.txteditor),i=this.WscrollBarWidth(),s=this.iconHeight,r=this.nToolbars*(s+6),n=this.wheight+r;0==i&&(i=18),document.writeln('<style type="text/css">'),document.writeln("textarea#"+this.name+" {display: none; margin: 0px; padding: 0px; border: none; font-size: 0;}"),document.writeln(".editor_clear {clear: both; padding-bottom: 5px;}"),document.writeln("div."+this.name+"_editor {width: "+this.wwidth+"px; height: "+n+"px; max-height: "+n+"px;}"),document.writeln("div."+this.name+"_toolbar {width: "+this.wwidth+"px; height: "+r+"px; background: gray;}"),document.writeln("div."+this.name+"_linebar {width: "+this.wwidth+"px; height: "+(s+7)+"px; background: #ddd; border-bottom: 1px solid gray;}"),document.writeln("div."+this.name+"_linebar ul {list-style: none; margin: 0px; clear: both; padding: 2px;}"),document.writeln("div."+this.name+"_linebar li {float: left; list-style: none; display: inline; height: "+(s+4)+"px; margin-left: 1px; clear: none;}"),document.writeln("div."+this.name+"_linebar li a {list-style: none;}"),document.writeln("div."+this.name+"_linebar li a:hover img {background: #eee; margin:2px; padding: 0px; background: #ccc;}"),document.writeln("div."+this.name+"_linebar li a img {border: none; margin:2px;}"),document.writeln("div."+this.txteditor+" {width: "+(this.wwidth-2)+"px; height: "+(this.wheight-3)+"px; display : block; background: #ddd;}"),document.writeln("div."+this.txteditor+" iframe {width: "+(this.wwidth-4)+"px; margin: 1px; height: "+(this.wheight-7)+"px; border: 1px #000 solid;}"),document.writeln("div."+this.txteditor+" textarea {width: "+(this.wwidth-i+2-12)+"px; margin: 1px; height: "+(this.wheight-31)+"px; resize: none; padding: 12px;}"),document.writeln("</style>"),document.writeln('<div class="'+this.name+'_editor">'),document.writeln(e),document.writeln('<div class="'+this.txteditor+'" name="'+this.txteditor+'">'),document.writeln('<div class="feditor"><iframe id="'+this.htmeditor+'" name="'+this.htmeditor+'" frameborder="0"></iframe></div>'),document.writeln('<div class="feditor"><textarea id="'+this.txteditor+'" name="'+this.txteditor+'" >'+this.loadtext(this.html)+"</textarea></div>"),document.getElementById(this.htmeditor).htmeditor=this.loadhtml(this.html),document.writeln('</div></div><div class="editor_clear"></div>'),this.designer(),t=document.getElementById(this.isEditable?this.txteditor:this.htmeditor),t.removeAttribute("style"),t.setAttribute("style","display: none; margin: 0px; padding: 0px; border: none; font-size: 0;"),t.style.cssText="display: none; margin: 0px; padding: 0px; border: none; font-size: 0;"},checkSubText:function(t,e,i){if(!e)return null;var s=e.split("|"),r=s.length,n=0,o=!1,l="",a="",d="",c="",h=new Array,u=new Array,m=0,p="";if(e=e.split("??"),null!=t&&""!=t){for(var g=0;r>g;g++)p=s[g],p.indexOf("??")>-1&&(p=s[g].split("??"),l=p[0]?p[0]:"",a=p[1]?p[1]:"",n=t.indexOf(l)>-1&&""!=l?l.length:0,p=l,t.indexOf(l)>-1&&(p+=t.substring(t.indexOf(l)+n,t.indexOf(a))),p+=a),t.indexOf(p)>-1&&(o=!0,m++,h[m]=p,u[m]=s[g]);o&&(h[1].indexOf("/")>-1?c=h[1]:d=h[1],h[2].indexOf("/")>-1?c=h[2]:d=h[2])}return"0"==i?o:{myKeys:u,myText:h,isSub:o,tag1:d,tag2:c}},checkText:function(t,e,i,s){var r="",n=t.toLowerCase(),o="",l="",a="",d=n.indexOf(e);pos2=n.indexOf(i);var c=""!==e&&null!==e?e.length:0,h=""!==i&&null!==i?i.length:0;switch(n=d>-1&&pos2>-1?t.substring(0,d)+t.substring(d+c,pos2)+t.substring(pos2+h):t,s){case"1":r=e;break;case"2":r=e,o=i;break;case"3":-1==d&&-1==pos2&&(r=e.toLowerCase(),o=i.toLowerCase());break;case"4":var u=this.checkSubText(t,"<ul>|</ul>|<ol>|</ol>",0);u?(alert(warnings[2]),l="<li>",a="</li>"):-1!==d||-1!==pos2||u?(r=null,n=null):(r=e.toLowerCase(),o=i.toLowerCase());break;case"5":-1==d&&-1==pos2&&(r=e,o=i+" \n");break;case"6":-1==d&&-1==pos2&&(r=e,o="")}return{txt1:r,txt2:n,txt3:o,txt4:l,txt5:a}},lasttag:function(){var t,e,i=document.getElementById(this.txteditor),s="";if(i.setSelectionRange){var r=i.value.substring(0,i.selectionStart),n=i.value.substring(i.selectionEnd,i.value.length);t=r.lastIndexOf("<"),s=r.substring(t),t=s.indexOf(">"),s=s.substring(0,t+1),t=n.indexOf("<"),e=n.indexOf(">",t),nexttag=n.substring(t,e)}else;return{lasttag:s,nexttag:nexttag}},editorCommand:function(t,e,i,s,r){var n,o=this.DOMcommands,l=this.insHTML,a=t,d=this.browser;if(this.isEditable&&-1!=o.indexOf(t)){n=document.getElementById(this.htmeditor).contentWindow;try{n.focus(),n.document.execCommand(t,!1,e),n.focus()}catch(c){alert(warnings[3])}}else{var h=this.externalcmds;if(-1!=h.indexOf(t))return void this[t]();var u=this.outcmds;if(-1!=u.indexOf(t))return void this.special(t,i,s);if(-1!=t.indexOf("bbc")){var m=t.substring(3);t=m}switch(t){case"bold":"msie"==d||"opera"==d?(i="<strong>",s="</strong>"):"firefox"==d?(i='<span style="font-weight: bold;">',s="</span>"):(i="<b>",s="</b>"),r="3";break;case"italic":"msie"==d||"opera"==d?(i="<em>",s="</em>"):"firefox"==d?(i='<span style="font-style: italic;">',s="</span>"):(i="<i>",s="</i>"),r="3";break;case"underline":"firefox"==d?(i='<span style="text-decoration: underline;">',s="</span>"):(i="<u>",s="</u>"),r="3";break;case"strikethrough":"firefox"==d?(i='<span style="text-decoration: line-through;">',s="</span>"):(i="<strike>",s="</strike>"),r="3";break;case"unlink":var p=this.getText(),g=p.indexOf("<a "),b=p.indexOf(">",g),i=p.substring(g,b+1);i=i.toLowerCase(),s="</a>",r="3";break;case"insertparagraph":i="<p>",s="</p>",r="3",a="";break;case"inserthorizontalrule":i="\n<hr>",s="\n",r="2";break;case"h1":case"h2":case"h3":a="formatBlock",i="<"+t+">",s="</"+t+">",r="3";break;case"linebreak":i="<br>",s="\n",r="2";break;case"insertunorderedlist":case"insertorderedlist":var f=this.lasttag(),x="insertunorderedlist"===t?"ul":"ol";"</li>"===f.lasttag?(i="<li>",s="</li>",r="3"):"<li>"!==f.lasttag?(i="<"+x+"><li>",s="</li></"+x+">",r="4"):alert(warnings[7]);break;case"code":i='<ol class="code"><li><code>Your code',s="</code></li></ol><br />",r="3",a="";break;case"subscript":i="<sub>",s="</sub>",r="3";break;case"superscript":i="<sup>",s="</sup>",r="3";break;default:if(-1!=this.smilley.indexOf(t)){var v=this.getRealPath()+"js/editor/";a="smilley",i='<img src="'+v+t+this.smilleyext+'" />',r="1"}else-1!=l.indexOf(t)&&(i="<"+t+">",s="</"+t+">",r="3")}if(-1!=l.indexOf(t))return void this.insertHtml(a,i,s,r);var w=this.smilley;if(-1!=w.indexOf(t))return void this.putsmilley(i);var y=document.getElementById(this.txteditor);if(y.setSelectionRange){var k,E=y.value.substring(0,y.selectionStart),O=y.value.substring(y.selectionEnd,y.value.length),T=this.checkText(y.value.substring(y.selectionStart,y.selectionEnd),i,s,r),$=T.txt1+T.txt2;k=3==r?T.txt1.length+T.txt2.length:$.length,$+=T.txt3,""!=T.txt4&&($=$.replace(T.txt4,"")),""!=T.txt5&&($=$.replace(T.txt5,"")),y.focus(),y.value=E+$+O,y.selectionStart=E.length+k,y.selectionEnd=E.length+k,y.focus()}else{var j=y.scrollTop;try{y.focus()}catch(c){}var B=document.selection.createRange(this.txteditor),L=B.text;if(L.length<=0){var I=i;""!==s&&null!==s&&(I+=s)}else{var _=this.checkText(L,i,s,r);I=_.txt2,null!==_.txt1&&null!==_.txt3&&(I=_.txt1+_.txt2+_.txt3)}I&&(B.text=I);try{y.focus()}catch(c){}y.scrollTop=j;try{y.focus()}catch(c){}B.select()}}},getRealPath:function(){var t=document.location.pathname,e=t.replace(/\\/g,"/").replace(/\/[^\/]*\/?$/,""),i=location.protocol+"//"+location.host+e.replace(/([+.]){0,}(admin\/)(.*)/gi,"$1");return i},switchmode:function(){this.wwidth,this.wheight;if(this.isEditable)obj1=document.getElementById(this.htmeditor),obj2=document.getElementById(this.txteditor),this.html=this.htmlclean(obj1.contentWindow.document.body.innerHTML),this.isEditable=!1;else{obj1=document.getElementById(this.txteditor),obj2=document.getElementById(this.htmeditor),this.html=this.txtclean(obj1.value),this.isEditable=!0;try{obj2.setfocus()}catch(t){}}obj1.removeAttribute("style"),obj1.setAttribute("style","display: none; margin: 0px; padding: 0px; border: none; font-size: 0;"),obj1.style.cssText="display: none; margin: 0px; padding: 0px; border: none; font-size: 0;",obj2.removeAttribute("style"),this.isEditable!==!1&&this.designer(),obj2.value=this.html,this.editor_focus()},insertHtml:function(t,e,i,s,r){var n;if(!this.isEditable)return void this.editorCommand("insertHTML",t,e,i,s);if(document.all){var o=frames[this.htmeditor].document.selection;null!=o&&(frames[this.htmeditor].focus(),o=o.createRange().text);var l=this.checkText(o,e,i,s,r);o=l.txt2,null!=l.txt1&&null!=l.txt3&&(o=l.txt1+l.txt2+l.txt3),n=document.getElementById(this.htmeditor).contentWindow.document.selection.createRange(this.htmeditor);try{n.pasteHTML(o),n.collapse(!1),n.select()}catch(a){alert(warnings[4])}}else{var o="";document.getElementById(this.htmeditor).contentWindow&&(o=document.getElementById(this.htmeditor).contentWindow.getSelection(),this.editorCommand("insertHTML",e+o+i,"","",s,r))}},getText:function(){if(document.all){var t=this.isEditable?frames[this.htmeditor].document.selection:document.selection.createRange(this.htmeditor).text;null!=t&&this.isEditable&&(frames[this.htmeditor].focus(),t=t.createRange().text)}else var e=document.getElementById(this.ehidden),t=this.isEditable?document.getElementById(this.htmeditor).contentWindow.getSelection():e.value.substring(e.selectionStart,e.selectionEnd);return t},editor_focus:function(){var t=this.isEditable?document.getElementById(this.htmeditor).contentWindow:document.getElementById(this.txteditor);t.focus()},isSelect:function(){var t=this.getText();return null==t||""==t?(alert(warnings[5]),this.editor_focus(this.editor),!1):!0},newLink:function(){if(this.isSelect()){var t=prompt(msgpr[0],"http://");if(null!=t&&""!=t&&"http://"!=t){var e=prompt(msgpr[1]);this.insertHtml("",'<a href="'+t+'" title="'+e+'" />',"</a>","2")}else this.editor_focus()}},removeLink:function(){if(this.isSelect()){var t=prompt(msgpr[0],"http://");if(null!=t&&""!=t&&"http://"!=t){var e=prompt(msgpr[1]);this.insertHtml("",'<a href="'+t+'" title="'+e+'" />',"</a>","2")}else this.editor_focus()}},table:function(){var t=this.getText(),e=this.checkSubText(t,"<table|<tr>|</tr>|<td>|</td>",0);if(e)return void alert(warnings[6]);var s=prompt(msgpr[4],"1");if(s){var r=prompt(msgpr[5],"1");if(r){var n=prompt(msgpr[6],"1");if(n&&null!=s&&""!=s){var o="",o='<table border="'+s+'"';for(o+=">",i=0;i<n;i++){for(o+="<tr>",j=0;j<r;j++)o+="<td>"+(i+1)+","+(j+1)+"</td>";o+="</tr>"}this.insertHtml("table",o,"</table>\n","3")}}}},image:function(){var t=prompt(msgpr[2],"http://");if(null!=t&&""!=t&&"http://"!=t){var e=prompt(msgpr[3]),i='<img src="'+t+'" alt="'+e+'"';this.insertHtml("image",i," />","3")}else this.editor_focus()},special:function(t){if(null!==t&&""!==t&&"undefined"!==t){var e=this.getText();e=null!==e&&""!==e?"":"Some Text",this.insertHtml("special","<"+t+">"+e,"</"+t+">","5")}else this.editor_focus()},youtube:function(){var t=prompt("Video","");if(null!=t&&""!=t){t=t.replace("http://youtu.be/","");var e='<iframe width="'+this.ytWidth+'" height="'+this.ytHeight+'" src="http://www.youtube.com/embed/'+t+'" frameborder="'+this.ytfborder+'" '+this.ytoptions+">";this.insertHtml("video",e,"</iframe>","6")}else this.editor_focus()},showButtons:function(){var t="";if(t+='<div class="'+this.name+'_tollbar">',""!==this.toolbar1&&null!==this.toolbar1&&void 0!==this.toolbar1){var e=this.drawToolbar(this.toolbar1);""!==e&&(t+='<div class="'+this.name+'_linebar"><ul>'+e+"</ul></div>")}if(""!==this.toolbar2&&null!==this.toolbar2&&void 0!==this.toolbar2){var i=this.drawToolbar(this.toolbar2);""!==i&&(t+='<div class="'+this.name+'_linebar"><ul>'+i+"</ul></div>")}if(""!==this.toolbar3&&null!==this.toolbar3&&void 0!==this.toolbar3){var s=this.drawToolbar(this.toolbar3);""!==s&&(t+='<div class="'+this.name+'_linebar"><ul>'+s+"</ul></div>")}if(""!==this.toolbar4&&null!==this.toolbar4&&void 0!==this.toolbar4){var r=this.drawToolbar(this.toolbar4);""!==r&&(t+='<div class="'+this.name+'_linebar"><ul>'+r+"</ul></div>")}return t+="</div>"},loadtext:function(t){return t=t.replace(/\&#/gi,"&#"),t=t.replace(/(\<)(xss|script|body|html|title|iframe|input|style)([^><]*){0,}(\>){0,}(\<){0,}/gi,"&lt;$2$3&gt;$5"),t=t.replace(/(\<)(\s)(p|div|pre|code|blockquote)([^><\s]*)(\s){0,}(\>)/gi,"&lt;$3$4&gt;"),t=t.replace(/(\<)(img)(\s[^>]*){0,}(javascript|on\w+\=|\&#|\t|DYNSRC|LOWSRC)([^><]*){0,}(\>){0,}(\>){0,}/gi,"&lt;$2$3$4$5&gt;$7"),t=t.replace(/(\<)(li)(\>)([^<>]*)(\<\/\2\>){0,}/gi,"<$2>$4</$2>"),t=t.replace(/(\<)(ul)([^>]*){0,}(\>){1,}((\<li\>[^<]*\<\/li\>){1,})(\<\/\2\>){1,}/gi,"<$2$3>$5</$2>$7")},loadhtml:function(t){return t=t.replace(/\\\'/gi,"'"),t=t.replace(/\\\"/gi,'"'),t=t.replace(/\&#/gi,"&#"),t=t.replace(/\r{3,}/gi,""),t=t.replace(/(\<)(iframe)((\x20(width|height|frameborder)="\d+"|allowfullscreen){0,})(\x20src="(http\:\/\/www\.youtube\.com\/embed\/\w+)")([^><]*)(\>\<\/iframe\>)/gi,"[video=youtube]$7[/video]"),t=t.replace(/(\<)(xss|script|body|html|title|iframe|input|style)([^><]*){0,}(\>){0,}(\<){0,}/gi,"&#60;$2$3&#62;$5"),t=t.replace(/(\<\/)(xss|script|body|title|iframe|style)(\>)/gi,"&lt;/$2&gt;"),t=t.replace(/(\<)(img)(\s[^>]*){0,}(javascript|on\w+\=|\&#|\t|DYNSRC|LOWSRC)([^><]*){0,}(\>){0,}(\<){0,}/gi,"&lt;$2$3$4$5&gt;$7"),t=t.replace(/(\<)(img)(\s\"\"\")([^>]*){0,}(\>)/gi,"&lt;$2$3$4&gt;"),t=t.replace(/(\<)(\?php)([^>]*)(\>)/gi,"&lt;$2$3&gt;"),t=t.replace(/(\<)(!--)([^>]*)(--)(\>)/gi,"&lt;$2$3$4&gt;"),t=t.replace(/(\[)(video=youtube\])(http\:\/\/www\.youtube\.com\/embed\/\w+)(\[\/video\])/gi,'<iframe width="'+this.ytWidth+'" height="'+this.ytHeight+'" src="$3" frameborder="'+this.ytfborder+'" '+this.ytoptions+"></iframe>")},htmlclean:function(t){return t=t.replace(/(<)([A-Z1-9]+)(>)/gi,function(t){return t.toLowerCase()}),t=t.replace(/(<\/)([A-Z1-9]+)(>)/gi,function(t){return t.toLowerCase()}),t=t.replace(/<(A|DIV|P|IMG)/gi,function(t){return t.toLowerCase()}),t=t.replace(/:%s\/<\/\?\\zs\\(\\a\\+\\)\\ze[ >]\/\L\1/gi,"<x$1>"),t=t.replace(/(\n){3,}/gi,"\n"),t=t.replace(/(\<\/p\>)/gi,"</p>\n"),t=t.replace(/(\<br\>)/gi,"<br>\n"),t=t.replace(/(&lt;)/gi,"<"),t=t.replace(/(&gt;)/gi,">"),t=t.replace(/(\&lt;)(xss|script)(\&lt;)/gi,"<$2$3>"),t=t.replace(/(\<\/)(xss|script)(\>)/gi,"&lt;/$2&gt;"),t=t.replace(/(\<)(img)(\s[^>]*){0,}(javascript|on\w+){0,}([^>]*){1,}(\>)/gi,"<$2$3>"),t=t.replace(/(\<)(iframe)((\x20(width|height|frameborder)="\d+"|allowfullscreen){0,})(\x20src="(http\:\/\/www\.youtube\.com\/embed\/\w+)")([^><]*)(\>\<\/iframe\>)/gi,"[video=youtube]$7[/video]"),t=t.replace(/(allowfullscreen)(=\"\")/gi,"$1"),t=t.replace(/(\<p\>)(\&nbsp;){0,}(\<\/p\>)/gi,"<br>"),t=t.replace(/(\&nbsp;)/gi," "),t=t.replace(/\<p\>\<br\>\n\<\/p\>/gi,"<br>")},txtclean:function(t){return t=t.replace(/(\<\/p\>\n\n)/g,"</p>"),t=t.replace(/(\<br>\n)/g,"<br>"),t=t.replace(/(\r)/g,""),t=t.replace(/(\<strong\>)/gi,"<b>"),t=t.replace(/(\<\/strong\>)/gi,"</b>"),t=this.loadhtml(t),t=t.replace(/(\&#60;)/gi,"<"),t=t.replace(/(\&#62;)/gi,">")},clean_tags:function(){if(0!=this.isEditable)return void alert("Not work in Design Mode, please change");var t=document.getElementById(this.txteditor);if(t.setSelectionRange){var e=t.value.substring(0,t.selectionStart),i=t.value.substring(t.selectionStart,t.selectionEnd),s=t.value.substring(t.selectionEnd);i=i.replace(/(<([^>]+)>)/gi,""),t.value=""!=i?e+i+s:e+s,t.focus(),t.selectionStart=e.length+i.length,t.selectionEnd=e.length+i.length,t.focus()}else{var r=t.scrollTop;t.focus();var n=document.selection.createRange(this.txteditor),i=n.text;i=i.replace(/(<([^>]+)>)/gi,""),n.text=i,t.focus(),t.scrollTop=r,t.focus(),n.select()}},putsmilley:function(t){this.insertHtml("image",t,"","1")},add_newcmd:function(t,e,i,s){ebookRTE.prototype[t]=function(){this.insertHtml(name,e,i,s)}}};